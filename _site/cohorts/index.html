<!-- Remove the comments to compress html

---
layout: compress
--- 

-->
<!DOCTYPE html>
<html>

  <head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
  
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Python cohort analysis | Things to share</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Python cohort analysis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A cohort is a group of subjects who share a common characteristic over a certain period of time." />
<meta property="og:description" content="A cohort is a group of subjects who share a common characteristic over a certain period of time." />
<link rel="canonical" href="http://localhost:4000/juliettm.github.io/cohorts/" />
<meta property="og:url" content="http://localhost:4000/juliettm.github.io/cohorts/" />
<meta property="og:site_name" content="Things to share" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-11-02T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python cohort analysis" />
<meta name="twitter:site" content="@" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2016-11-02T00:00:00+01:00","datePublished":"2016-11-02T00:00:00+01:00","description":"A cohort is a group of subjects who share a common characteristic over a certain period of time.","headline":"Python cohort analysis","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/juliettm.github.io/cohorts/"},"url":"http://localhost:4000/juliettm.github.io/cohorts/"}</script>
<!-- End Jekyll SEO tag -->

  
<style>
          
          img{max-width:100%}.mt50{margin-top:50px}.mt20{margin-top:20px}.mt10{margin-top:10px}.navbar-brand{font-weight:900;font-size:1.85em;padding:10px}@media screen and (max-width: 600px){.navbar-brand{font-size:1.5em}}.post-meta{color:#828282}.panel{border:none;box-shadow:0px 0px 1px #828282}.panel:hover{box-shadow:0px 0px 6px #828282}footer{border-top:1px solid #e8e8e8}.social{list-style:none;display:inline;margin-left:10px;padding:5px 8px}.social:hover{opacity:0.7}.social img{width:20px}.quora img{width:17px}.facebook img{width:16px}.recent ul{list-style:none;padding:0;text-align:justify}.recent{padding:10px;border:1px solid #e8e8e8}.post-img img{width:100%}.pack{display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap}.card{float:none}

</style>  

<link rel="stylesheet" href="/juliettm.github.io/css/bootstrap.min.css">
<link rel="alternate" type="application/rss+xml" title="Things to share" href="http://localhost:4000/juliettm.github.io/feed.xml">  
</head>


  <body>

    <header class="site-header">
  <nav class="navbar navbar-default navbar-inverse">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/juliettm.github.io/">Things to share</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/juliettm.github.io/about/">About</a></li>
        </ul>
      </div>
    </div>
  </nav>
</header>


    <div class="container">
      <div class="wrapper">
        <div class="row">
<div class="col-md-8">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">Python cohort analysis</h1>
            <p class="post-meta"><time datetime="2016-11-02T00:00:00+01:00" itemprop="datePublished">Nov 2, 2016</time></p>
                 
          </header>

          <div class="post-content" itemprop="articleBody">
            <p>A cohort is a group of subjects who share a common characteristic over a certain period of time.</p>

<p>Cohort analysis allows keep on track some aspects of interest in business. Cohort analisis groups people by some characteristic in common and follow the behavior of the groups in time.</p>

<p>The common characteristic of the group could vary depending on the objective of the cohort analysis and the period could be any time agregation necesary to measure the value of interest. There is many alternatives to make cohort analysis, could be useful to make channel acquisition analysis, to predict lifetime value, in this case let’s visualize an user retention example.</p>

<h2 id="example-user-retention">Example: User retention</h2>
<p>There are different definitions of retention but let’s define the user retention for an app as the percentage of users who come back and perform any action in the app “N” days after they start using it.</p>

<p>The cohort group will be defined by the date in which the user download the app: each group “contains” all new users that download the app each day. The cohort period will be the days after the download. The Day 1 retention will be 100% for all groups no matter how many users download the app and the subsequents days retention will be the percentage of the users who come back and perform any action in the app. This view shows how much the users are interacting with the app.</p>

<h2 id="python">Python</h2>

<p>A total of 13 days will be considered for the example. The cohort groups involves the users that has been downloaded the app each day and the cohort period will be the days after the download.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Number of days to track
</span><span class="n">n</span> <span class="o">=</span> <span class="mi">13</span> 
<span class="c1"># Dates of download (Cohort Groups)
</span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">date_range</span><span class="p">(</span><span class="s">'20161001'</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">n</span><span class="p">).</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y-%m-%d'</span><span class="p">))</span>
<span class="c1"># Study days (Cohort Period) 
</span><span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s">"Day "</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>
</code></pre></div></div>

<p>The analysis will consider the percent of the users that keep using the app each day after the download.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate the data for analysis
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Generate values between 1 and 1000
</span>    <span class="n">val</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> 
    <span class="c1"># Sort values and reverse the order 
</span>    <span class="n">sorted_val</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">val</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
    <span class="c1"># Divide the data by the higher value
</span>    <span class="c1"># This is the number of users that download the app (day one)
</span>    <span class="n">data</span> <span class="o">+=</span> <span class="p">[[</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">sorted_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">sorted_val</span><span class="p">]]</span>
<span class="c1"># Create a data frame with the generated data
</span><span class="n">retention</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
<span class="n">retention</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span><span class="s">'Cohort Group'</span>
<span class="n">retention</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'Cohort Period'</span>
</code></pre></div></div>

<p><a href="http://seaborn.pydata.org/">Seaborn</a> is a Python library which provides a <a href="http://seaborn.pydata.org/generated/seaborn.heatmap.html">heatmap</a> visualization that makes possible a beautiful cohort analysis design.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Seaborn heatmap
</span><span class="n">sns</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">'white'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Cohorts: User Retention'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">retention</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">'.0%'</span><span class="p">)</span>
</code></pre></div></div>
<p>The figure shows the result, the color scale shows how is decreasing the use of the app after the download day. The company could take actions, based on the data, to improve the engagement with the app.</p>

<p><img src="/juliettm.github.io/images/cohort/cohort.png" alt="Cohort: User retention" /></p>

<p>The ipython notebook with this code is available in the <a href="https://github.com/juliettm/pyCohort">pyCohort</a> repository.</p>


          </div>

    </article>
    
    
    <div class="row">
            <ul class="pager">
             
                    <li><a class="next" href="/juliettm.github.io/text/">&laquo; Topic modeling</a></li>
              
              
            </ul>
    </div>
</div>


<div class="col-md-4 mt20">
  <div class="post-img">
    
      <img width="600" src="/juliettm.github.io/images/cohort/cohort_front.png" alt="Python cohort analysis">
    
  </div>
            
        
  <div class="mt10 recent">
    <h2>Recent articles</h2>        
    <ul>
      
        <li>
          <p>
            <a href="/juliettm.github.io/text/">Topic modeling</a>
            <small>&nbsp;&nbsp;24 Feb 2017</small>
          </p>
        </li>

      
    </ul>
  </div>        

</div>

</div>

    <script>
    (function() {
        var font3 = document.createElement('link'); 
        font3.type = 'text/css'; 
        font3.rel = 'stylesheet';
        font3.href = '/juliettm.github.io/css/syntax-highlighting.css';
        var q = document.getElementsByTagName('link')[0]; 
        q.parentNode.insertBefore(font3, q);
      })();
</script>
      </div>
    </div>

    
<footer class="container">

  <div class="row mt20">
    
    <div class="col-md-4 text-center" >
    </div>

    <div class="col-md-4 text-center">
        <a target="_blank" href="https://es.linkedin.com/in/juliettm"><li class="social linkedin"><img src="/juliettm.github.io/images/linkedin.svg" alt="https://es.linkedin.com/in/juliettm"></li></a>      
        <a target="_blank" href="https://twitter.com/jsuarezferreira"><li class="social twitter"><img src="/juliettm.github.io/images/twitter.svg" alt="https://twitter.com/jsuarezferreira"></li></a>      
        <a target="_blank" href="https://github.com/juliettm"><li class="social github"><img src="/juliettm.github.io/images/github.svg" alt="https://github.com/juliettm"></li></a>
    </div>
  
  </div> 

</footer>

    
<script async>
    (function() {
        var font = document.createElement('link'); 
        font.type = 'text/css'; 
        font.rel = 'stylesheet';
        font.href = '//fonts.googleapis.com/css?family=Raleway:400,700';
        var s = document.getElementsByTagName('link')[0]; 
        s.parentNode.insertBefore(font, s);
      })();
</script>
    
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script src="/juliettm.github.io/js/bootstrap.min.js"></script>
  <!-- Google Analytics Tracking code -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87271398-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
  (function(e,t){var n=e.amplitude||{_q:[],_iq:{}};var r=t.createElement("script");r.type="text/javascript";
  r.async=true;r.src="https://d24n15hnbwhuhn.cloudfront.net/libs/amplitude-3.0.1-min.gz.js";
  r.onload=function(){e.amplitude.runQueuedFunctions()};var i=t.getElementsByTagName("script")[0];
  i.parentNode.insertBefore(r,i);function s(e,t){e.prototype[t]=function(){this._q.push([t].concat(Array.prototype.slice.call(arguments,0)));
  return this}}var o=function(){this._q=[];return this};var a=["add","append","clearAll","prepend","set","setOnce","unset"];
  for(var u=0;u<a.length;u++){s(o,a[u])}n.Identify=o;var c=function(){this._q=[];return this;
  };var p=["setProductId","setQuantity","setPrice","setRevenueType","setEventProperties"];
  for(var l=0;l<p.length;l++){s(c,p[l])}n.Revenue=c;var d=["init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut","setVersionName","setDomain","setDeviceId","setGlobalUserProperties","identify","clearUserProperties","setGroup","logRevenueV2","regenerateDeviceId"];
  function v(e){function t(t){e[t]=function(){e._q.push([t].concat(Array.prototype.slice.call(arguments,0)));
  }}for(var n=0;n<d.length;n++){t(d[n])}}v(n);n.getInstance=function(e){e=(!e||e.length===0?"$default_instance":e).toLowerCase();
  if(!n._iq.hasOwnProperty(e)){n._iq[e]={_q:[]};v(n._iq[e])}return n._iq[e]};e.amplitude=n;
  })(window,document);

  amplitude.getInstance().init("10e4977a0d52770f9ff9c5ec879c9bb0");
</script>
  </body>

</html>
